.. _files_deploy:

-------------
Files：デプロイ
-------------

.. _deploying_files:

Filesをデプロイする
+++++++++++++++++

#. **Prism> ファイルサーバー** で、 **+ File Server 「ファイルサーバー」** をクリックして、 **New File Server Pre-Check** ダイアログを開きます

   .. figure:: images/1.png

   時間を節約するために、ファイルはすでにクラスターにアップロードされています。ファイルのバイナリは
   Prismから直接ダウンロードするか、手動でアップロードできます

   .. figure:: images/2.png

   さらに、クラスタの **Data Servicesデータサービス** IPアドレスはすでに構成されています（*10.XX.YY.38*)
   Filesクラスターでは、ストレージはiSCSI経由でボリュームグループとしてFiles VMに提供されるため、Data Services IPに依存します

   .. note::

     注意:
     ご自身の環境でデプロイする場合は、 :fa:`gear` > **Cluster Details 「クラスタの詳細」** を選択し、
     **iSCSI Data Services IP「iSCSIデータサービスIP」** を指定して[保存]をクリックすることで、データサービスIPを簡単に構成できます。
     Data Services IPはCVMと同じサブネットにある必要があります。
     Filesは、少なくとも1つのネットワークがクラスター上で構成されていることを確認します。クライアント側のネットワークとストレージ側のネットワークをセグメント化するには、最低2つのネットワークが推奨されます。

#. **Continue「続行」** をクリックします

   .. figure:: images/3.png

#. 次のフィールドに入力します:

   - **Name「名前」** - *Intials*-Files（例：XYZ-Files）
   - **Domain「ドメイン」** - ntnxlab.local
   - **File Server Size「 ファイルサーバーサイズ」** - 1 TiB

   .. figure:: images/4.png

   .. note::

     注意: **Custom Configuration「カスタム構成」**　をクリックすると、ユーザーとスループットのターゲットに基づいて、Files VMのサイズの変更とサイズ変更を変更できます。また、Filesクラスターのサイズを手動で設定することもできます

   .. figure:: images/5.png

#. **Next「次へ」**　をクリックします

#. **Client Network　「クライアントネットワーク」** の **Secondary - Managed「セカンダリ-管理対象」** VLANを選択します

   各Files VMは、クライアントネットワークで単一のIPを消費します

   .. note::

     注意: HPOC環境では、クライアントネットワークとストレージネットワークを別々に使用する場合は、クライアントネットワークにセカンダリVLANを使用することが重要です
     通常、本番環境では、クライアントとストレージのトラフィック用に専用の仮想ネットワークを使用してファイルをデプロイすることが望ましいです。 2つのネットワークを使用する場合、Filesは設計上、
     クライアントによるストレージネットワークへのトラフィックを許可しません。つまり、プライマリネットワークに割り当てられたVMは共有にアクセスできません

#. クラスターの **Domain Controller 「ドメインコントローラー」VM IP** を **DNS Resolver IP 「DNSリゾルバIP」** （10.XX.YY.40など）として指定します。デフォルト（クラスター）NTPサーバーのままにします

   .. note::
     .. raw:: html

       <strong><font color="red">Filesクラスターが正常にNTNXLAB.localドメインを見つけて参加するには、DNSリゾルバーIPがクラスターのドメインコントローラーVM IPに設定されていることが重要です。デフォルトでは、このフィールドはNutanixクラスタ用に構成されたプライマリネームサーバーIPに設定されています。この値は正しくないため、機能しません</font></strong>

   .. figure:: images/7.png

#. **Next「次へ」** をクリックします

#. Select the **Primary - Managed** VLAN for the Storage Network. ストレージネットワークの **Primary - Managed「プライマリ-管理対象」** VLANを選択します

   各ファイルVMは、ストレージネットワーク上の単一のIPに加えて、クラスター用に1つの追加IPを消費します.

   .. figure:: images/8.png

#. **Next「次へ」** をクリックします

#. 次のフィールドに入力します:

   - **Use SMB ProtocolSMB「プロトコルを使用」** を選択します
   - **Username「ユーザー名」** - Administrator@ntnxlab.local
   - **Password「パスワード」** - nutanix/4u
   - **Make this user a File Server admin「このユーザーをファイルサーバー管理者にする」** を選択します。
   - **Use NFS Protocol　「NFSプロトコルを使用」**　を選択します
   - **User Management and Authentication「ユーザー管理と認証」** - Unmanaged「非管理」

   .. figure:: images/9.png

   .. note::

     注意: 非管理モードでは、ユーザーはUID / GIDによってのみ識別されます。ファイル3.5では、ファイルはNFSv3とNFSv4の両方をサポートします

#. **Next「次へ」** をクリックします

   デフォルトでは、Filesは自動的に保護ドメインを作成して、Filesクラスターのスナップショットを毎日作成し、以前の2つのスナップショットを保持します。展開後、スナップショットスケジュールを変更したり、リモートレプリケーションサイトを定義したりできます

   .. figure:: images/10.png

#. **Create「作成」** をクリックして、Filesの展開を開始します

#. **Prism > Tasks** で展開の進捗状況を監視します

   .. figure:: images/11.png

   .. note::

     注意: DNSレコード検証の失敗に関する警告を受け取った場合、これは無視しても問題ありません。共有クラスターはFilesクラスターと同じDNSサーバーを使用しないため、ファイルのデプロイ時に作成されたDNSエントリを解決できません

#. **Prism** > File Server「ファイルサーバー」に移動し、*Initials*\ **-Filesサーバー**　を選択して、**Protect**　をクリックします

   .. figure:: images/12.png

#. デフォルトのセルフサービスリストアスケジュールを確認します。この機能は、Windowsの以前のバージョンの機能のスナップショットスケジュールを制御します。以前のバージョンをサポートすることで、エンドユーザーはストレージやバックアップの管理者に依頼することなく、
   ファイルへの変更をロールバックできます。これらのローカルスナップショットはファイルサーバークラスターをローカルの障害から保護せず、ファイルサーバークラスター全体のレプリケーションをリモートNutanixクラスターに実行できることに注意してください。閉じるをクリックします

   .. figure:: images/13.png

持ち帰り
+++++++

**Nutanix Files** について知っておくべき重要なことは何ですか?

- ファイルは既存のNutanixクラスターの上に迅速に展開でき、ユーザー共有、ホームディレクトリ、部門共有、アプリケーション、およびその他の汎用ファイルストレージのニーズにSMBおよびNFSストレージを提供します
- Filesはポイントソリューションではありません。 VM、ファイル、ブロック、およびオブジェクトのストレージはすべて、同じ管理ツールを使用して同じプラットフォームで配信できるため、複雑さと管理のサイロが軽減されます
